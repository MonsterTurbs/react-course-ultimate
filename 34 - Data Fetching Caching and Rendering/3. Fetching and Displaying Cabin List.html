<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Next.js (RSC) ‚Äî Fetching & Displaying the Cabin List (Study Guide)</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #111111;
      --muted: #555555;
      --border: #e6e6e6;
      --soft: #fafafa;
      --chip: #f3f4f6;
      --accent: #0b57d0;
      --good: #137333;
      --warn: #b26a00;
      --bad: #b00020;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, Helvetica, sans-serif;
      line-height: 1.6;
      overflow-wrap: anywhere;
      word-break: normal;
    }

    /* Single-column, print-friendly container */
    .page {
      max-width: 820px;
      margin: 0 auto;
      padding: 28px 22px 60px;
    }

    header {
      border: 1px solid var(--border);
      background: var(--soft);
      padding: 18px 18px 14px;
      border-radius: 12px;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 22px;
      letter-spacing: 0.2px;
    }

    .subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 13.5px;
    }

    .meta {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .chip {
      display: inline-block;
      padding: 6px 10px;
      border: 1px solid var(--border);
      background: var(--chip);
      border-radius: 999px;
      font-size: 12.5px;
      color: #1f2937;
    }

    main { margin-top: 18px; }

    section {
      margin: 14px 0;
      padding: 14px 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
    }

    h2 {
      margin: 0 0 10px;
      font-size: 17px;
    }

    h3 {
      margin: 14px 0 8px;
      font-size: 14.5px;
    }

    p { margin: 8px 0; }

    ul, ol {
      margin: 8px 0 8px 20px;
      padding: 0;
    }

    li { margin: 6px 0; }

    .callout {
      border-left: 4px solid var(--accent);
      background: #f7fbff;
      padding: 10px 12px;
      border-radius: 8px;
      margin: 10px 0;
    }

    .callout.good { border-left-color: var(--good); background: #f6fff8; }
    .callout.warn { border-left-color: var(--warn); background: #fffaf2; }
    .callout.bad  { border-left-color: var(--bad);  background: #fff5f6; }

    .k {
      display: inline-block;
      padding: 0 6px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: #fff;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px;
    }

    pre {
      margin: 10px 0;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #f5f5f5;
      color: #111111;
      overflow: auto;
      white-space: pre;
      font-size: 12.8px;
      line-height: 1.55;
    }

    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.95em;
    }

    .two-col {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .mini {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      background: var(--soft);
    }

    .mini h4 {
      margin: 0 0 8px;
      font-size: 13.5px;
    }

    .muted { color: var(--muted); }

    .hr {
      height: 1px;
      background: var(--border);
      margin: 14px 0;
    }

    a { color: var(--accent); text-decoration: underline; text-underline-offset: 2px; }

    /* PRINT: A4, clean margins, hide URL expansions */
    @page { size: A4; margin: 14mm; }

    @media print {
      body { background: #fff; }
      .page { max-width: none; padding: 0; }
      header { background: #fff; }
      section, header { break-inside: avoid; page-break-inside: avoid; }
      pre { break-inside: avoid; page-break-inside: avoid; }
      a { color: #000; text-decoration: none; }
      a[href]:after { content: ""; } /* do NOT print URLs */
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>üè° Fetching & Displaying the Cabin List (Next.js + React Server Components)</h1>
      <p class="subtitle">
        Reviewer / study guide for building the <strong>/cabins</strong> page: server-side data fetching with <strong>async server components</strong>,
        rendering a list, fixing remote images with <strong>next/image</strong>, and using <strong>next/link</strong> for navigation.
      </p>
      <div class="meta">
        <span class="chip">üìå Topic: Data fetching in RSC</span>
        <span class="chip">üß† Level: Beginner-friendly</span>
        <span class="chip">üñ®Ô∏è A4 Print-ready</span>
        <span class="chip">üß© Key APIs: getCabins ¬∑ next/image ¬∑ next/link</span>
      </div>
    </header>

    <main>
      <section>
        <h2>1) Goal of this lesson üéØ</h2>
        <ul>
          <li>Build the <strong>Cabins overview page</strong> at <span class="k">/cabins</span>.</li>
          <li>Replace a placeholder empty array with <strong>real data from Supabase</strong> (via your prewritten data service).</li>
          <li>Render one <strong>CabinCard</strong> per cabin (list rendering).</li>
          <li>Fix image warnings and errors by properly using <span class="k">next/image</span> with <strong>remote images</strong>.</li>
          <li>Use <span class="k">next/link</span> so each cabin card can link to a future detail route like <span class="k">/cabins/123</span>.</li>
        </ul>
      </section>

      <section>
        <h2>2) The big idea: Data fetching in a Server Component üöÄ</h2>
        <p>
          In the Next.js App Router, pages are <strong>Server Components by default</strong>. That means you can write:
          <strong>async page components</strong> and use <strong>await</strong> directly.
        </p>

        <div class="callout good">
          <strong>‚úÖ Why this feels ‚Äúmagic‚Äù:</strong> No <span class="k">useEffect</span>, no client-side state just to store fetched data,
          and often no extra libraries for fetching.
        </div>

        <h3>What happens during rendering?</h3>
        <ol>
          <li>Next.js starts rendering your page component on the <strong>server</strong>.</li>
          <li>Execution reaches <span class="k">await getCabins()</span> and <strong>pauses</strong> until data arrives.</li>
          <li>Once data arrives, rendering continues and the HTML is produced.</li>
          <li>The browser receives HTML that already contains the cabin list (SSR initial load).</li>
        </ol>

        <div class="callout">
          <strong>üß© Mental model:</strong> This is like doing server-side rendering with ‚Äúnormal‚Äù Node.js async/await‚Ä¶
          except you‚Äôre still writing React.
        </div>
      </section>

      <section>
        <h2>3) Minimal example: Fetch cabins and render CabinCards üß±</h2>
        <p class="muted">This is a simplified version of what the lecture is doing (names may vary in your project).</p>

        <pre><code>// app/cabins/page.js
import CabinCard from "@/app/_components/CabinCard";
import { getCabins } from "@/app/_lib/data-service";

export default async function Page() {
  console.log("starting...");

  const cabins = await getCabins();
  console.log("cabins:", cabins);

  return (
    &lt;div&gt;
      &lt;h1&gt;Cabins&lt;/h1&gt;

      &lt;div&gt;
        {cabins.map((cabin) =&gt; (
          &lt;CabinCard key={cabin.id} cabin={cabin} /&gt;
        ))}
      &lt;/div&gt;
    &lt;/div&gt;
  );
}</code></pre>

        <div class="callout warn">
          <strong>‚ö†Ô∏è Where do console.logs appear?</strong>
          <ul>
            <li>If the code runs on the <strong>server</strong> (Server Component), logs appear in the <strong>terminal</strong> running Next.js.</li>
            <li>If the code runs on the <strong>client</strong> (Client Component), logs appear in the <strong>browser console</strong>.</li>
          </ul>
        </div>

        <p>
          In the lecture, logging ‚Äústarting‚Ä¶‚Äù and then ‚Äúcabins‚Äù demonstrates that the async function begins,
          pauses at <span class="k">await</span>, and resumes once data arrives.
        </p>
      </section>

      <section>
        <h2>4) Why this is better than ‚Äúclassic‚Äù client data fetching ‚úÖ</h2>
        <div class="two-col">
          <div class="mini">
            <h4>Old pattern (Client-side fetching)</h4>
            <ul>
              <li>Render empty UI first</li>
              <li><span class="k">useEffect</span> fetches after paint</li>
              <li>Show loaders manually</li>
              <li>Store result in <span class="k">useState</span></li>
            </ul>
          </div>
          <div class="mini">
            <h4>New pattern (Server Component fetching)</h4>
            <ul>
              <li>Fetch on the server during render</li>
              <li>Return ready-to-display HTML</li>
              <li>Often simpler code</li>
              <li>Data stays close to the DB/API</li>
            </ul>
          </div>
        </div>

        <div class="callout">
          <strong>üß† Bonus concept:</strong>
          When the data source is on the server (like a DB or filesystem), you can sometimes skip building a separate API layer.
          With Supabase you still call an API behind the scenes, but the client library hides most of the HTTP details.
        </div>
      </section>

      <section>
        <h2>5) Fixing CabinCard images with next/image üñºÔ∏è</h2>
        <p>
          When you use <span class="k">&lt;img /&gt;</span> in Next.js, you‚Äôll often get a warning recommending
          <span class="k">next/image</span> (better performance: resizing, modern formats, lazy loading, fewer layout shifts).
        </p>

        <h3>Problem A: ‚ÄúMissing required width property‚Äù</h3>
        <p>
          If your image source is a <strong>string URL</strong> (e.g., coming from Supabase), Next.js can‚Äôt automatically know dimensions.
          You must use <strong>width/height</strong> or <strong>fill</strong>.
        </p>

        <div class="callout warn">
          <strong>Rule of thumb:</strong>
          <ul>
            <li>Static import (local image import) ‚Üí Next.js can infer dimensions</li>
            <li>String URL (remote image) ‚Üí you must give <span class="k">width</span>/<span class="k">height</span> OR use <span class="k">fill</span></li>
          </ul>
        </div>

        <h3>Problem B: Remote images must be allowed in next.config.js</h3>
        <p>
          If the image is hosted on another domain (Supabase storage), you must allow it in
          <span class="k">next.config.js</span> using <span class="k">images.remotePatterns</span>.
        </p>

        <pre><code>// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "YOUR-SUPABASE-PROJECT.supabase.co",
        pathname: "/storage/v1/object/public/**",
      },
    ],
  },
};

module.exports = nextConfig;</code></pre>

        <div class="callout bad">
          <strong>‚ùå Common mistake:</strong> Including <span class="k">https://</span> inside <span class="k">hostname</span>.
          The protocol is set separately.
        </div>

        <h3>Problem C: Using fill requires a positioned parent</h3>
        <p>
          If you use <span class="k">fill</span>, the image becomes absolutely positioned and needs a parent with
          <span class="k">position: relative</span> and a defined box size.
        </p>

        <pre><code>// CabinCard.jsx (conceptual)
import Image from "next/image";
import Link from "next/link";

export default function CabinCard({ cabin }) {
  return (
    &lt;div className="flex gap-6 border rounded-xl p-4"&gt;
      &lt;div className="relative flex-1"&gt;
        &lt;Image
          src={cabin.image}
          alt={cabin.name}
          fill
          className="object-cover"
        /&gt;
      &lt;/div&gt;

      &lt;div className="flex-[2]"&gt;
        &lt;h3&gt;{cabin.name}&lt;/h3&gt;
        &lt;Link href={`/cabins/${cabin.id}`}&gt;Details&lt;/Link&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}</code></pre>

        <div class="callout good">
          <strong>‚úÖ Why the ‚Äúrelative parent‚Äù matters:</strong> Without it, the image may try to fill the entire viewport,
          or Next.js will warn that it can‚Äôt determine proper layout.
        </div>
      </section>

      <section>
        <h2>6) Adding navigation with next/link üîó</h2>
        <p>
          Next.js wants you to use <span class="k">Link</span> instead of a plain <span class="k">&lt;a&gt;</span> tag for internal routes,
          so navigation stays fast and ‚Äúapp-like.‚Äù
        </p>

        <pre><code>import Link from "next/link";

// inside CabinCard
&lt;Link href={`/cabins/${cabin.id}`}&gt;
  View details
&lt;/Link&gt;</code></pre>

        <div class="callout">
          <strong>üìù Important:</strong> In this lecture, clicking a cabin goes to a URL like <span class="k">/cabins/7</span>.
          If you haven‚Äôt created that route yet, you‚Äôll see a 404 ‚Äî that‚Äôs expected until you build the dynamic route.
        </div>
      </section>

      <section>
        <h2>7) Quick checklist ‚úÖ</h2>
        <ul>
          <li>‚úÖ <strong>/cabins page</strong> is an <span class="k">async</span> Server Component.</li>
          <li>‚úÖ You call <span class="k">await getCabins()</span> from the data service.</li>
          <li>‚úÖ Render list with <span class="k">cabins.map(...)</span> and provide <span class="k">key={cabin.id}</span>.</li>
          <li>‚úÖ CabinCard uses <span class="k">next/image</span> for images.</li>
          <li>‚úÖ Remote image domain/pattern is allowed in <span class="k">next.config.js</span>.</li>
          <li>‚úÖ CabinCard wraps internal navigation with <span class="k">next/link</span>.</li>
        </ul>
      </section>

      <section>
        <h2>8) Common errors & fixes üßØ</h2>
        <h3>‚ÄúMissing required width property‚Äù</h3>
        <ul>
          <li>Use <span class="k">width</span> + <span class="k">height</span> OR <span class="k">fill</span>.</li>
          <li>If using <span class="k">fill</span>, add <span class="k">className="relative"</span> to the parent and make sure it has a real size.</li>
        </ul>

        <h3>‚ÄúInvalid src prop‚Äù / Remote image not allowed</h3>
        <ul>
          <li>Add Supabase hostname + pathname pattern to <span class="k">images.remotePatterns</span> in <span class="k">next.config.js</span>.</li>
          <li>Do not include <span class="k">https://</span> inside hostname.</li>
        </ul>

        <h3>Image fills the entire viewport</h3>
        <ul>
          <li>That‚Äôs almost always missing <span class="k">position: relative</span> on the parent, or missing parent dimensions.</li>
          <li>Give the parent a predictable box (e.g., aspect ratio, fixed height, or flex-based sizing).</li>
        </ul>
      </section>

      <section>
        <h2>9) Mini self-test üß†</h2>
        <ol>
          <li>Why do <span class="k">console.log</span> statements appear in the terminal when used in a Server Component?</li>
          <li>When do you need <span class="k">remotePatterns</span> in Next.js?</li>
          <li>What two things are required when using <span class="k">fill</span> on <span class="k">next/image</span>?</li>
          <li>Why is <span class="k">next/link</span> preferred over <span class="k">&lt;a&gt;</span> for internal navigation?</li>
        </ol>

        <div class="hr"></div>

        <p class="muted">
          Next lesson (based on the transcript): you‚Äôll implement the cabin detail route (<span class="k">/cabins/[cabinId]</span>)
          and continue improving streaming/caching behavior.
        </p>
      </section>
    </main>
  </div>
</body>
</html>
