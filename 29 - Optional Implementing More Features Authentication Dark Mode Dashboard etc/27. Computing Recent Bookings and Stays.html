<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>React Study Guide â€” Bookings vs Stays + Recent Data Hooks (React Query + date-fns)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#555555;
      --border:#e6e6e6;
      --panel:#fafafa;
      --chip:#f3f4f6;
      --link:#0b57d0;
      --shadow: 0 8px 30px rgba(0,0,0,.06);

      /* High-contrast code theme */
      --code-bg:#0b1220;
      --code-text:#e6edf3;
      --code-border:#1f2937;
      --inline-bg:#eef2ff;
      --inline-border:#dbeafe;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: Arial, Helvetica, sans-serif;
      line-height:1.65;
      overflow-wrap:anywhere;
      word-break:normal;
    }

    .page{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 18px 56px;
    }

    header{
      padding: 18px 18px;
      border:1px solid var(--border);
      border-radius: 14px;
      background: linear-gradient(180deg, #fff, var(--panel));
      box-shadow: var(--shadow);
    }

    h1{
      margin: 0 0 8px;
      font-size: 24px;
      letter-spacing: .2px;
      line-height: 1.25;
    }

    .subtitle{
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .toolbar{
      margin-top: 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:1px solid var(--border);
      background:#fff;
      border-radius: 10px;
      padding: 9px 12px;
      cursor:pointer;
      font-weight:600;
      font-size: 13px;
    }
    .btn:hover{ border-color:#cfcfcf; }
    .btn:active{ transform: translateY(1px); }

    .meta{
      margin-left:auto;
      color:var(--muted);
      font-size: 12px;
    }

    main{
      margin-top: 18px;
      padding: 18px;
      border:1px solid var(--border);
      border-radius: 14px;
      background:#fff;
      box-shadow: var(--shadow);
    }

    h2{
      margin: 18px 0 10px;
      font-size: 18px;
      line-height: 1.25;
    }
    h3{
      margin: 14px 0 8px;
      font-size: 15px;
      line-height: 1.3;
    }

    p{ margin: 8px 0; }
    ul{ margin: 8px 0 8px 20px; padding:0; }
    li{ margin: 6px 0; }

    .callout{
      border:1px solid var(--border);
      background: var(--panel);
      border-radius: 12px;
      padding: 12px 12px;
      margin: 12px 0;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin: 10px 0 0;
      padding: 0;
      list-style:none;
    }
    .chip{
      background: var(--chip);
      border:1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color:#222;
    }

    .divider{
      height:1px;
      background:var(--border);
      margin: 16px 0;
    }

    .small{ color:var(--muted); font-size: 13px; }

    /* Code blocks */
    code, pre{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                   "Liberation Mono", "Courier New", monospace;
    }
    code{
      background: var(--inline-bg);
      color:#111111;
      padding: 1px 6px;
      border-radius: 6px;
      border: 1px solid var(--inline-border);
      font-size: 0.95em;
      opacity: 1 !important;
    }
    pre{
      margin: 10px 0;
      padding: 12px 14px;
      border-radius: 12px;
      background: var(--code-bg);
      color: var(--code-text);
      border: 1px solid var(--code-border);
      overflow:auto;
      max-width: 100%;
      box-shadow: 0 2px 14px rgba(0,0,0,.10);
      opacity: 1 !important;
    }
    pre code{
      background: transparent !important;
      border: 0 !important;
      padding: 0 !important;
      border-radius: 0 !important;
      color: inherit !important;
      font-size: 12.8px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-wrap: anywhere;
      word-break: break-word;
      opacity: 1 !important;
    }

    @media print{
      @page{ size: A4; margin: 12mm; }
      body{ background:#fff; }
      .page{ padding: 0; margin: 0; max-width: none; }
      header, main{ box-shadow: none; }
      header{ break-inside: avoid; }
      .toolbar{ display:none !important; }
      a[href]::after{ content:""; }

      pre{
        background:#ffffff !important;
        color:#111111 !important;
        border: 1px solid #d0d0d0 !important;
        box-shadow: none !important;
        overflow: visible !important;
      }
      pre code{
        white-space: pre-wrap !important;
        overflow-wrap: anywhere !important;
        word-break: break-word !important;
      }

      .callout{ break-inside: avoid; }
      h2{ break-after: avoid; }
    }
  </style>
</head>

<body>
  <div class="page">
    <header>
      <h1>ğŸ“Š Dashboard Data Prep â€” Bookings vs Stays (Critical Concept)</h1>
      <p class="subtitle">
        Before building charts/statistics, we must fetch and compute two different datasets from Supabase:
        <strong>Bookings</strong> (sales) and <strong>Stays</strong> (guest check-ins/outs).
      </p>

      <div class="toolbar">
        <button class="btn" type="button" onclick="window.print()">ğŸ–¨ï¸ Print / Save as PDF</button>
        <button class="btn" type="button" onclick="window.scrollTo({top:0,behavior:'smooth'})">â¬†ï¸ Back to Top</button>
        <span class="meta">Single-column â€¢ A4 print-ready â€¢ High-contrast code</span>
      </div>

      <ul class="chips" aria-label="key tags">
        <li class="chip">ğŸ§¾ Bookings = sales</li>
        <li class="chip">ğŸ¨ Stays = check-ins/outs</li>
        <li class="chip">ğŸ—“ï¸ last 7 / 30 / 90 days</li>
        <li class="chip">âš¡ React Query</li>
        <li class="chip">ğŸ§® Confirmed stays</li>
        <li class="chip">ğŸ“… ISO date strings</li>
      </ul>
    </header>

    <main>
      <h2>1) Bookings vs Stays â€” whatâ€™s the difference?</h2>
      <p>
        âš ï¸ This distinction is essential for correct dashboard statistics.
      </p>

      <div class="callout">
        <p><strong>ğŸ§¾ Booking = a sale (createdAt)</strong></p>
        <ul>
          <li>A booking is made when the guest pays / reserves (an online sale).</li>
          <li>Example: in the last 30 days, you might have <strong>50 bookings</strong>.</li>
          <li>But many of those guests may arrive much later (weeks/months/year).</li>
          <li>Bookings are typically filtered by <code>createdAt</code> (when the booking was created).</li>
        </ul>
      </div>

      <div class="callout">
        <p><strong>ğŸ¨ Stay = actual hotel activity (startDate + status)</strong></p>
        <ul>
          <li>A stay represents guests who actually arrive and stay (or already left).</li>
          <li>You identify stays by <code>startDate</code> (when the stay begins) and a status like:
            <code>checked-in</code> or <code>checked-out</code>.</li>
          <li>Stays are used for charts like stay duration, occupancy, etc.</li>
        </ul>
      </div>

      <p>
        âœ… Summary: <strong>Bookings = sales</strong>, <strong>Stays = real-world check-ins/outs</strong>.
        Different charts need different datasets.
      </p>

      <div class="divider"></div>

      <h2>2) Fetching â€œrecent bookingsâ€ (created between date and today)</h2>
      <p>
        A helper API function returns bookings created after a given date (for last 7/30/90 days).
        The query filters:
      </p>
      <ul>
        <li>ğŸ“… <strong>createdAt &gt;= queryDate</strong></li>
        <li>ğŸ“… <strong>createdAt &lt;= today</strong></li>
      </ul>

      <div class="callout">
        <p><strong>ğŸ§  ISO string requirement</strong></p>
        <p>
          Supabase expects dates in ISO format, so the date passed into the query must be an ISO string.
        </p>
      </div>

      <h3>Helper: â€œtoday as an ISO stringâ€ with stable day boundaries</h3>
      <p>
        The lecture mentions an important trick: when we say â€œtodayâ€, we donâ€™t want the time to change every second,
        because then â€œtodayâ€ would shift continuously.
      </p>

      <ul>
        <li>âœ… If <code>end: true</code> â†’ set time to the <strong>last millisecond of the day</strong>.</li>
        <li>âœ… Otherwise â†’ set time to the <strong>first millisecond of the day</strong>.</li>
      </ul>

      <div class="callout">
        <p><strong>Why this matters</strong></p>
        <ul>
          <li>Prevents bugs where â€œtodayâ€ changes during runtime and causes unstable query results.</li>
          <li>Makes â€œbetween X and todayâ€ a clean date range.</li>
        </ul>
      </div>

      <div class="divider"></div>

      <h2>3) Create a custom hook: <code>useRecentBookings</code></h2>
      <p>
        The dashboard uses search params to choose the time window: last 7, 30, or 90 days.
      </p>

      <h3>Step A â€” read the â€œlastâ€ filter from the URL</h3>
      <pre><code>// Example logic (conceptual)
import { useSearchParams } from "react-router-dom";

const [searchParams] = useSearchParams();
const numDays = Number(searchParams.get("last")) || 7;</code></pre>

      <h3>Step B â€” compute the query date with <code>subDays</code> (date-fns)</h3>
      <p>
        The API needs an actual date (7/30/90 days ago), not just the number.
      </p>

      <pre><code>import { subDays } from "date-fns";

const queryDate = subDays(new Date(), numDays).toISOString();</code></pre>

      <div class="callout">
        <p><strong>âœ… Pattern</strong></p>
        <ul>
          <li>â€œnumDaysâ€ is for UI/filters.</li>
          <li>â€œqueryDateâ€ is what the backend query actually uses.</li>
        </ul>
      </div>

      <h3>Step C â€” React Query with a dynamic queryKey</h3>
      <p>
        If the user switches 7 â†’ 30 â†’ 90 days, we want React Query to refetch automatically.
        Thatâ€™s why we include <code>numDays</code> in the query key.
      </p>

      <pre><code>import { useQuery } from "@tanstack/react-query";
import { getBookingsAfterDate } from "../services/apiBookings";

export function useRecentBookings() {
  const [searchParams] = useSearchParams();
  const numDays = Number(searchParams.get("last")) || 7;

  const queryDate = subDays(new Date(), numDays).toISOString();

  const { isLoading, data: bookings, error } = useQuery({
    queryKey: ["bookings", `last-${numDays}`],
    queryFn: () =&gt; getBookingsAfterDate(queryDate),
  });

  return { isLoading, bookings, error, numDays };
}</code></pre>

      <div class="callout">
        <p><strong>ğŸ§  queryKey rule of thumb</strong></p>
        <p>
          If the fetched data depends on a variable (like <code>numDays</code>),
          put that variable in the query key so caching + refetching behave correctly.
        </p>
      </div>

      <div class="divider"></div>

      <h2>4) Confirm caching behavior (why spinners disappear)</h2>
      <p>
        Once data is fetched for a specific key (e.g., last-7, last-30),
        React Query caches it. When you switch between filters, it can often serve data instantly
        from the cache without showing a loading spinner again.
      </p>

      <ul>
        <li>âš¡ Faster UI when switching between 7/30/90 days</li>
        <li>ğŸ§  Data retrieval feels instant because itâ€™s served from cache</li>
      </ul>

      <div class="divider"></div>

      <h2>5) Do the same for stays: <code>useRecentStays</code></h2>
      <p>
        Recent stays come from the same bookings table, but are filtered by <strong>startDate</strong>
        (when the stay begins), not <code>createdAt</code>.
      </p>

      <pre><code>import { useQuery } from "@tanstack/react-query";
import { getStaysAfterDate } from "../services/apiBookings";

export function useRecentStays() {
  const [searchParams] = useSearchParams();
  const numDays = Number(searchParams.get("last")) || 7;

  const queryDate = subDays(new Date(), numDays).toISOString();

  const { isLoading, data: stays } = useQuery({
    queryKey: ["stays", `last-${numDays}`],
    queryFn: () =&gt; getStaysAfterDate(queryDate),
  });

  // âœ… Confirmed stays only (ignore "unconfirmed")
  const confirmedStays = stays?.filter(
    (stay) =&gt; stay.status === "checked-in" || stay.status === "checked-out"
  );

  return { isLoading, stays, confirmedStays, numDays };
}</code></pre>

      <div class="callout">
        <p><strong>Why confirmedStays matters</strong></p>
        <ul>
          <li>Some guests never show up â†’ booking stays <code>unconfirmed</code> forever.</li>
          <li>For many dashboard stats, you only want stays that actually happened:
            <code>checked-in</code> or <code>checked-out</code>.</li>
        </ul>
      </div>

      <div class="divider"></div>

      <h2>6) Quick sanity checks from the lecture</h2>
      <ul>
        <li>ğŸ§¾ Bookings count usually increases as you move from 7 â†’ 30 â†’ 90 days.</li>
        <li>ğŸ¨ Stays count can be lower than bookings (because many bookings are for future dates).</li>
        <li>âœ… Example observation:
          <ul>
            <li>Last 7 days: bookings = 7, stays = 7 (can happen in seed data)</li>
            <li>Last 90 days: bookings &gt; stays (common in real systems)</li>
          </ul>
        </li>
      </ul>

      <div class="divider"></div>

      <h2>7) Quick self-check (practice)</h2>
      <ul>
        <li>ğŸ§  Whatâ€™s the business difference between a booking and a stay?</li>
        <li>ğŸ“… Why does <code>getBookingsAfterDate</code> use <code>createdAt</code> but <code>getStaysAfterDate</code> uses <code>startDate</code>?</li>
        <li>âš¡ Why is <code>numDays</code> included in the React Query key?</li>
        <li>âœ… Why do we filter out <code>unconfirmed</code> for <code>confirmedStays</code>?</li>
        <li>ğŸ•’ Why is â€œend of dayâ€ / â€œstart of dayâ€ normalization useful for date ranges?</li>
      </ul>

      <p class="small">
        End of reviewer. Next lecture: use these datasets to compute dashboard statistics and build charts.
      </p>
    </main>
  </div>
</body>
</html>
