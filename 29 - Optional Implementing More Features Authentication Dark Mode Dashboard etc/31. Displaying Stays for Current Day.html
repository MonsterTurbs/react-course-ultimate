<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>React Study Guide â€” Today Activity (Dashboard) + React Query + Supabase OR/AND Filters</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#555555;
      --border:#e6e6e6;
      --panel:#fafafa;
      --chip:#f3f4f6;
      --link:#0b57d0;
      --shadow: 0 8px 30px rgba(0,0,0,.06);

      /* High-contrast code theme */
      --code-bg:#0b1220;
      --code-text:#e6edf3;
      --code-border:#1f2937;
      --inline-bg:#eef2ff;
      --inline-border:#dbeafe;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: Arial, Helvetica, sans-serif;
      line-height:1.65;
      overflow-wrap:anywhere;
      word-break:normal;
    }

    /* Single-column */
    .page{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 18px 56px;
    }

    header{
      padding: 18px 18px;
      border:1px solid var(--border);
      border-radius: 14px;
      background: linear-gradient(180deg, #fff, var(--panel));
      box-shadow: var(--shadow);
    }

    h1{
      margin: 0 0 8px;
      font-size: 24px;
      letter-spacing: .2px;
      line-height: 1.25;
    }

    .subtitle{
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .toolbar{
      margin-top: 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:1px solid var(--border);
      background:#fff;
      border-radius: 10px;
      padding: 9px 12px;
      cursor:pointer;
      font-weight:600;
      font-size: 13px;
    }
    .btn:hover{ border-color:#cfcfcf; }
    .btn:active{ transform: translateY(1px); }

    .meta{
      margin-left:auto;
      color:var(--muted);
      font-size: 12px;
    }

    main{
      margin-top: 18px;
      padding: 18px;
      border:1px solid var(--border);
      border-radius: 14px;
      background:#fff;
      box-shadow: var(--shadow);
    }

    h2{
      margin: 18px 0 10px;
      font-size: 18px;
      line-height: 1.25;
    }
    h3{
      margin: 14px 0 8px;
      font-size: 15px;
      line-height: 1.3;
    }

    p{ margin: 8px 0; }
    ul{ margin: 8px 0 8px 20px; padding:0; }
    li{ margin: 6px 0; }

    .callout{
      border:1px solid var(--border);
      background: var(--panel);
      border-radius: 12px;
      padding: 12px 12px;
      margin: 12px 0;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin: 10px 0 0;
      padding: 0;
      list-style:none;
    }
    .chip{
      background: var(--chip);
      border:1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color:#222;
    }

    .divider{
      height:1px;
      background:var(--border);
      margin: 16px 0;
    }

    .small{ color:var(--muted); font-size: 13px; }

    /* Code blocks */
    code, pre{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                   "Liberation Mono", "Courier New", monospace;
    }
    code{
      background: var(--inline-bg);
      color:#111111;
      padding: 1px 6px;
      border-radius: 6px;
      border: 1px solid var(--inline-border);
      font-size: 0.95em;
      opacity: 1 !important;
    }
    pre{
      margin: 10px 0;
      padding: 12px 14px;
      border-radius: 12px;
      background: var(--code-bg);
      color: var(--code-text);
      border: 1px solid var(--code-border);
      overflow:auto;
      max-width: 100%;
      box-shadow: 0 2px 14px rgba(0,0,0,.10);
      opacity: 1 !important;
    }
    pre code{
      background: transparent !important;
      border: 0 !important;
      padding: 0 !important;
      border-radius: 0 !important;
      color: inherit !important;
      font-size: 12.8px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-wrap: anywhere;
      word-break: break-word;
      opacity: 1 !important;
    }

    /* Print */
    @media print{
      @page{ size: A4; margin: 12mm; }
      body{ background:#fff; }
      .page{ padding: 0; margin: 0; max-width: none; }
      header, main{ box-shadow: none; }
      header{ break-inside: avoid; }
      .toolbar{ display:none !important; }
      a[href]::after{ content:""; }

      pre{
        background:#ffffff !important;
        color:#111111 !important;
        border: 1px solid #d0d0d0 !important;
        box-shadow: none !important;
        overflow: visible !important;
      }
      pre code{
        white-space: pre-wrap !important;
        overflow-wrap: anywhere !important;
        word-break: break-word !important;
      }

      .callout{ break-inside: avoid; }
      h2{ break-after: avoid; }
    }
  </style>
</head>

<body>
  <div class="page">
    <header>
      <h1>ğŸ¨ Today Activity (Dashboard) â€” Arrivals & Departures</h1>
      <p class="subtitle">
        Feature: Show guests who must <strong>check in</strong> today (arrivals) or <strong>check out</strong> today (departures),
        powered by a targeted Supabase query + React Query state management.
      </p>

      <div class="toolbar">
        <button class="btn" type="button" onclick="window.print()">ğŸ–¨ï¸ Print / Save as PDF</button>
        <button class="btn" type="button" onclick="window.scrollTo({top:0,behavior:'smooth'})">â¬†ï¸ Back to Top</button>
        <span class="meta">Single-column â€¢ A4 print-ready â€¢ High-contrast code</span>
      </div>

      <ul class="chips" aria-label="key tags">
        <li class="chip">ğŸ“… Today Activity</li>
        <li class="chip">âœ… Check-in</li>
        <li class="chip">ğŸšª Check-out</li>
        <li class="chip">âš¡ React Query</li>
        <li class="chip">ğŸ§ª Supabase OR/AND</li>
      </ul>
    </header>

    <main>
      <h2>1) What is â€œToday Activityâ€?</h2>
      <p>
        ğŸ§¾ In this app, an <strong>activity</strong> means one of two things happening today:
      </p>
      <ul>
        <li>ğŸŸ¢ <strong>Arriving</strong>: guest has a booking that starts today and is <code>unconfirmed</code> (not checked in yet).</li>
        <li>ğŸ”µ <strong>Departing</strong>: guest is <code>checked-in</code> and their booking ends today (ready to check out).</li>
      </ul>

      <div class="callout">
        <p><strong>ğŸ“ Folder structure idea (important)</strong></p>
        <p>
          The component is inside a <code>check-in-out</code> folder even if it appears in the <em>dashboard UI</em>.
          Thatâ€™s because folders represent <strong>features/domains</strong>, not where the component visually appears.
        </p>
        <p class="small">
          âœ… This is a scalable way to organize large apps: group by feature (check-in/out) rather than by UI location (dashboard).
        </p>
      </div>

      <div class="divider"></div>

      <h2>2) Donâ€™t download all bookings (efficiency)</h2>
      <p>
        âš ï¸ A naive approach would be:
        â€œFetch all bookings ever created, then filter in JavaScript.â€
        That becomes slow and wasteful as the database grows.
      </p>

      <div class="callout">
        <p><strong>âœ… Better approach</strong></p>
        <p>
          Push filtering to the database query: fetch only bookings that match â€œarriving todayâ€ OR â€œdeparting todayâ€.
        </p>
      </div>

      <div class="divider"></div>

      <h2>3) Supabase query: OR with AND conditions</h2>
      <p>
        You build a query with an <code>or()</code> that contains two conditions (separated by a comma).
        Inside each part, you can also include an <code>and</code>.
      </p>

      <h3>âœ… Meaning of the filter</h3>
      <ul>
        <li><strong>Arriving today</strong> = <code>status = "unconfirmed"</code> AND <code>startDate = today</code></li>
        <li><strong>Departing today</strong> = <code>status = "checked-in"</code> AND <code>endDate = today</code></li>
      </ul>

      <pre><code>// PSEUDO-CODE idea (readable form)
( status === "unconfirmed" AND startDate === today )
OR
( status === "checked-in" AND endDate === today )</code></pre>

      <div class="callout">
        <p><strong>ğŸ§  Why the Supabase syntax feels â€œweirdâ€</strong></p>
        <ul>
          <li>Because itâ€™s a string-based DSL (domain-specific language).</li>
          <li>You wonâ€™t use this exact complex pattern daily, but itâ€™s good to know it exists.</li>
          <li>Always check Supabase docs when building advanced filters like this.</li>
        </ul>
      </div>

      <div class="divider"></div>

      <h2>4) React Query: <code>useTodayActivity</code> hook</h2>
      <p>
        Next, we manage the API state with React Query. This is a â€œsimpleâ€ query:
        a <code>queryKey</code> and a <code>queryFn</code>.
      </p>

      <pre><code>// useTodayActivity.js (conceptual)
import { useQuery } from "@tanstack/react-query";
import { getStaysTodayActivity } from "../services/apiBookings";

export function useTodayActivity() {
  const { isLoading, data: activities } = useQuery({
    queryKey: ["today-activity"],
    queryFn: getStaysTodayActivity,
  });

  return { isLoading, activities };
}</code></pre>

      <div class="callout">
        <p><strong>ğŸ“Œ Why the query key is only <code>["today-activity"]</code></strong></p>
        <p>
          The â€œtoday activityâ€ is not affected by filters like â€œlast X daysâ€ (used elsewhere in dashboard stats),
          so it doesnâ€™t need extra key parts.
        </p>
      </div>

      <div class="divider"></div>

      <h2>5) Rendering UI states (without hiding the whole component)</h2>
      <p>
        In this feature, you still want to show the container while data loads,
        so instead of returning early (e.g., <code>if (isLoading) return &lt;Spinner /&gt;</code>),
        you render the spinner only inside the section.
      </p>

      <pre><code>// TodayActivity.jsx (conceptual rendering)
function TodayActivity() {
  const { isLoading, activities } = useTodayActivity();

  return (
    &lt;div&gt;
      &lt;h3&gt;Today Activity&lt;/h3&gt;

      {isLoading ? (
        &lt;Spinner /&gt;
      ) : activities?.length &gt; 0 ? (
        &lt;TodayList&gt;
          {activities.map(activity =&gt; (
            &lt;TodayItem key={activity.id} activity={activity} /&gt;
          ))}
        &lt;/TodayList&gt;
      ) : (
        &lt;p&gt;No activity today.&lt;/p&gt;
      )}
    &lt;/div&gt;
  );
}</code></pre>

      <div class="callout">
        <p><strong>âœ… The 3 UI cases you must handle</strong></p>
        <ul>
          <li>â³ Loading: show spinner in the section.</li>
          <li>ğŸ“‹ Has activities: render list.</li>
          <li>ğŸ˜´ No activities: show â€œNo activity today.â€</li>
        </ul>
      </div>

      <div class="divider"></div>

      <h2>6) TodayItem: Arriving vs Departing tag</h2>
      <p>
        Each activity is basically a booking, so it contains data like:
        <code>id</code>, <code>status</code>, <code>guests</code>, <code>numNights</code>, etc.
      </p>

      <h3>Tag logic</h3>
      <ul>
        <li>ğŸŸ¢ If <code>status === "unconfirmed"</code> â†’ show <strong>Arriving</strong> (green tag)</li>
        <li>ğŸ”µ Else (checked-in) â†’ show <strong>Departing</strong> (blue tag)</li>
      </ul>

      <pre><code>// TodayItem.jsx (conceptual)
function TodayItem({ activity }) {
  const { id, status, guests, numNights } = activity;

  const arriving = status === "unconfirmed";

  return (
    &lt;StyledTodayItem&gt;
      {arriving ? (
        &lt;Tag type="green"&gt;Arriving&lt;/Tag&gt;
      ) : (
        &lt;Tag type="blue"&gt;Departing&lt;/Tag&gt;
      )}

      &lt;Flag src={guests.countryFlag} alt={`Flag of ${guests.country}`} /&gt;
      &lt;Guest&gt;{guests.fullName}&lt;/Guest&gt;

      &lt;div&gt;{numNights} nights&lt;/div&gt;

      {/* button slot goes here */}
    &lt;/StyledTodayItem&gt;
  );
}</code></pre>

      <div class="divider"></div>

      <h2>7) Actions: Check-in link vs Checkout button</h2>

      <h3>ğŸŸ¢ Arriving: â€œCheck inâ€ should navigate to Check-in page</h3>
      <p>
        For arriving guests, you donâ€™t â€œmutateâ€ immediately here â€” you navigate to the check-in route.
        The lecture uses a styled <code>Button</code> component but renders it as a React Router <code>Link</code>
        using the <code>as</code> prop.
      </p>

      <pre><code>// Arriving button (conceptual)
&lt;Button
  size="small"
  variation="primary"
  as={Link}
  to={`/checkin/${id}`}
&gt;
  Check in
&lt;/Button&gt;</code></pre>

      <div class="callout">
        <p><strong>ğŸ§  Why <code>as={Link}</code> is useful</strong></p>
        <ul>
          <li>Your design system keeps consistent button styling.</li>
          <li>But the underlying element becomes a link (anchor) for navigation.</li>
        </ul>
      </div>

      <h3>ğŸ”µ Departing: Checkout needs logic â†’ extract to <code>CheckoutButton</code></h3>
      <p>
        For checked-in guests, checkout triggers more logic (mutation + loading/disable state),
        so itâ€™s cleaner to extract it into its own component.
      </p>

      <pre><code>// TodayItem.jsx (conceptual)
{status === "unconfirmed" ? (
  &lt;Button
    size="small"
    variation="primary"
    as={Link}
    to={`/checkin/${id}`}
  &gt;
    Check in
  &lt;/Button&gt;
) : (
  &lt;CheckoutButton bookingId={id} /&gt;
)}</code></pre>

      <pre><code>// CheckoutButton.jsx (conceptual)
function CheckoutButton({ bookingId }) {
  const { checkout, isCheckingOut } = useCheckout();

  return (
    &lt;Button
      size="small"
      variation="primary"
      disabled={isCheckingOut}
      onClick={() =&gt; checkout(bookingId)}
    &gt;
      Check out
    &lt;/Button&gt;
  );
}</code></pre>

      <div class="callout">
        <p><strong>âœ… UX detail</strong></p>
        <ul>
          <li>Disable the button while checking out (<code>isCheckingOut</code>) to prevent double clicks.</li>
          <li>After successful check-in/out, the dashboard stats and TodayActivity list update.</li>
        </ul>
      </div>

      <div class="divider"></div>

      <h2>8) What you observe after check-in/out (data refresh)</h2>
      <p>
        After checking someone in:
      </p>
      <ul>
        <li>ğŸ“Š Dashboard stats/graphs update (you may see smooth animation on charts).</li>
        <li>ğŸ§¾ The guest disappears from â€œArrivingâ€ list because theyâ€™re no longer <code>unconfirmed</code>.</li>
      </ul>

      <p>
        After checking someone out:
      </p>
      <ul>
        <li>ğŸšª Booking status changes and the â€œDepartingâ€ list updates.</li>
        <li>âœ… You can now manage checkouts from the dashboard (not only from the bookings table).</li>
      </ul>

      <div class="divider"></div>

      <h2>9) Quick self-check (practice)</h2>
      <ul>
        <li>ğŸ§  Define â€œactivityâ€ in this app. What are the two types?</li>
        <li>âš¡ Why is filtering in Supabase better than downloading all bookings and filtering in JS?</li>
        <li>ğŸ§© Why do we use <code>as={Link}</code> for the Check-in action?</li>
        <li>ğŸ” Why is checkout extracted into a <code>CheckoutButton</code> component?</li>
        <li>âœ… What 3 UI states does TodayActivity handle?</li>
      </ul>

      <p class="small">
        End of reviewer. Use Print / Save as PDF. The design avoids cut-off and prints cleanly on A4.
      </p>
    </main>
  </div>
</body>
</html>
