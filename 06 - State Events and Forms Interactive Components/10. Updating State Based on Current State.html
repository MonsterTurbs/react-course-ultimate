

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>React Study Guide ‚Äî Updating State Based on Current State</title>
  <style>
    :root {
      --bg: #ffffff;
      --text: #111111;
      --muted: #555555;
      --border: #e6e6e6;
      --soft: #fafafa;
      --accent: #1a73e8;
      --code-bg: #0b1020;
      --code-text: #e8eefc;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, Helvetica, sans-serif;
      line-height: 1.6;
      overflow-wrap: anywhere;
      word-break: normal;
    }

    .page {
      max-width: 820px;
      margin: 0 auto;
      padding: 28px 22px;
    }

    header {
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 18px;
    }

    h1 {
      font-size: 1.55rem;
      margin: 0 0 6px;
      letter-spacing: -0.01em;
    }

    .subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 0.98rem;
    }

    .meta {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .chip {
      display: inline-block;
      padding: 6px 10px;
      border: 1px solid var(--border);
      background: var(--soft);
      border-radius: 999px;
      font-size: 0.88rem;
      color: var(--muted);
    }

    main { padding-bottom: 6px; }

    h2 {
      font-size: 1.15rem;
      margin: 18px 0 10px;
    }

    h3 {
      font-size: 1.02rem;
      margin: 14px 0 8px;
    }

    p { margin: 10px 0; }

    ul { margin: 10px 0 10px 20px; padding: 0; }
    li { margin: 6px 0; }

    .callout {
      border: 1px solid var(--border);
      background: var(--soft);
      padding: 12px 12px;
      border-radius: 10px;
      margin: 12px 0;
    }

    .callout strong { color: var(--text); }

    .rule {
      border-left: 4px solid var(--accent);
      padding: 10px 12px;
      background: #f7fbff;
      border-radius: 8px;
      margin: 12px 0;
    }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: #f2f4f8;
      border: 1px solid var(--border);
      border-bottom-width: 2px;
      padding: 1px 6px;
      border-radius: 6px;
      font-size: 0.92em;
      white-space: nowrap;
    }

    pre {
      margin: 10px 0;
      padding: 12px 12px;
      background: var(--code-bg);
      color: var(--code-text);
      border-radius: 10px;
      overflow: auto;
      white-space: pre-wrap;
      word-break: break-word;
      border: 1px solid rgba(255,255,255,0.08);
    }

    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.95em;
    }

    .inline-code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: #f2f4f8;
      border: 1px solid var(--border);
      padding: 1px 6px;
      border-radius: 6px;
      white-space: nowrap;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .divider {
      height: 1px;
      background: var(--border);
      margin: 18px 0;
    }

    .small { color: var(--muted); font-size: 0.95rem; }

    /* Print (A4) */
    @page { size: A4; margin: 12mm; }

    @media print {
      :root { --bg: #ffffff; }
      body { background: #ffffff; }
      .page { max-width: none; padding: 0; }
      a { color: inherit; text-decoration: none; }
      a[href]::after { content: ""; }
      pre { page-break-inside: avoid; }
      .callout, .rule { page-break-inside: avoid; }
      h1, h2, h3 { page-break-after: avoid; }
      ul, li { page-break-inside: avoid; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>üß† React ‚Äî Updating State Based on Current State</h1>
      <p class="subtitle">Study guide / reviewer: why and how to use ‚Äúfunctional updates‚Äù (callback form) with <span class="inline-code">setState</span> in React hooks.</p>
      <div class="meta">
        <span class="chip">‚úÖ Beginner-friendly</span>
        <span class="chip">üß© useState patterns</span>
        <span class="chip">‚ö†Ô∏è Avoid stale state bugs</span>
        <span class="chip">üñ®Ô∏è A4 print-ready</span>
      </div>
    </header>

    <main>
      <h2>1) What does ‚Äúupdate based on current state‚Äù mean?</h2>
      <p>In React, you often set new state using the <strong>previous/current value</strong> of that same state variable. Examples:</p>
      <ul>
        <li>‚ûï Increment/decrement a counter: <span class="inline-code">step + 1</span> or <span class="inline-code">step - 1</span></li>
        <li>üîÅ Toggle a boolean: <span class="inline-code">!isOpen</span></li>
      </ul>

      <div class="rule">
        <strong>Golden rule ‚ú®</strong><br />
        If your next state depends on the previous state, prefer the <strong>callback/functional update</strong> form:
        <div class="small">This prevents bugs when React batches updates or when multiple updates happen quickly.</div>
      </div>

      <h2>2) The ‚Äúworks now‚Ä¶ breaks later‚Äù problem</h2>
      <p>The ‚Äúdirect‚Äù style looks correct and often works:</p>
      <pre><code>// ‚úÖ Often works
setStep(step + 1);

// ‚úÖ Often works
setIsOpen(!isOpen);
</code></pre>

      <p>But it can fail in situations where you call the setter multiple times in one event, or when updates are batched:</p>
      <pre><code>// ‚ùå You might EXPECT +2, but you often get only +1
setStep(step + 1);
setStep(step + 1);
</code></pre>

      <div class="callout">
        <strong>Why does this happen? ü§î</strong>
        <ul>
          <li>React may <strong>batch</strong> state updates for performance.</li>
          <li>Both updates can ‚Äúsee‚Äù the same old <span class="inline-code">step</span> value from the current render.</li>
          <li>So you end up applying ‚Äú+1 from the same old value‚Äù twice, which collapses into one effective update.</li>
        </ul>
      </div>

      <h2>3) The correct pattern: functional (callback) updates</h2>
      <p>Instead of passing a value, pass a function. React will call it with the <strong>latest</strong> previous state value:</p>
      <pre><code>// ‚úÖ Best practice when next state depends on previous state
setStep((s) =&gt; s + 1);
setStep((s) =&gt; s - 1);
</code></pre>

      <h3>‚úÖ Now calling it twice works as expected</h3>
      <pre><code>// ‚úÖ This reliably increments by 2
setStep((s) =&gt; s + 1);
setStep((s) =&gt; s + 1);
</code></pre>

      <div class="callout">
        <strong>Naming the argument üè∑Ô∏è</strong>
        <ul>
          <li>You can name it <span class="inline-code">prev</span>, <span class="inline-code">current</span>, <span class="inline-code">s</span>, etc.</li>
          <li>Many devs use <span class="inline-code">prev</span> for clarity: <span class="inline-code">setStep(prev =&gt; prev + 1)</span></li>
        </ul>
      </div>

      <h2>4) Example: toggling booleans safely</h2>
      <p>For toggles (open/close, dark/light), the functional form is also the safest:</p>
      <pre><code>// ‚úÖ Toggle with functional update
setIsOpen((open) =&gt; !open);
</code></pre>

      <h2>5) When is the callback NOT necessary?</h2>
      <p>If the next state does <strong>not</strong> depend on the previous state, passing a value is perfectly fine:</p>
      <pre><code>// ‚úÖ Overwrite with a known value
setStep(1);
setIsOpen(true);
</code></pre>

      <h2>6) Practical cheat sheet (memorize this)</h2>
      <div class="grid">
        <div class="callout">
          <strong>‚úÖ Use functional update when:</strong>
          <ul>
            <li>Next state depends on previous state</li>
            <li>Increment/decrement counters</li>
            <li>Toggling booleans</li>
            <li>You might call the setter multiple times</li>
          </ul>
        </div>
        <div class="callout">
          <strong>‚úÖ Use direct value when:</strong>
          <ul>
            <li>You already know the exact next value</li>
            <li>Resetting state (e.g., back to defaults)</li>
            <li>Setting from external input (e.g., API result)</li>
          </ul>
        </div>
      </div>

      <div class="divider"></div>

      <h2>7) Mini examples (copy/paste friendly)</h2>

      <h3>Counter stepper ‚ûï‚ûñ</h3>
      <pre><code>function Counter() {
  const [step, setStep] = React.useState(1);

  function next() {
    setStep((s) =&gt; Math.min(3, s + 1));
  }

  function prev() {
    setStep((s) =&gt; Math.max(1, s - 1));
  }

  return (
    &lt;div&gt;
      &lt;p&gt;Step: {step}&lt;/p&gt;
      &lt;button onClick={prev}&gt;Previous&lt;/button&gt;
      &lt;button onClick={next}&gt;Next&lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre>

      <h3>Toggle UI section üîÅ</h3>
      <pre><code>function Panel() {
  const [isOpen, setIsOpen] = React.useState(true);

  return (
    &lt;&gt;
      &lt;button onClick={() =&gt; setIsOpen((o) =&gt; !o)}&gt;
        {isOpen ? "Close" : "Open"}
      &lt;/button&gt;

      {isOpen &amp;&amp; (
        &lt;div&gt;
          &lt;p&gt;Hello! I am visible when open.&lt;/p&gt;
        &lt;/div&gt;
      )}
    &lt;/&gt;
  );
}
</code></pre>

      <div class="divider"></div>

      <h2>8) Quick self-check (1 minute)</h2>
      <ul>
        <li>‚úÖ If you see <span class="inline-code">setX(x + 1)</span>, ask: ‚ÄúCould this run multiple times or be batched?‚Äù</li>
        <li>‚úÖ If yes (or unsure), switch to: <span class="inline-code">setX(prev =&gt; prev + 1)</span></li>
        <li>‚úÖ For toggles, default to: <span class="inline-code">setOpen(o =&gt; !o)</span></li>
      </ul>

      <div class="callout">
        <strong>Memory hook üß†</strong><br />
        ‚ÄúIf the next value depends on the previous value, use <em>prev =&gt; ...</em>.‚Äù
      </div>

      <h2>9) Key takeaway</h2>
      <p>
        React state updates can be batched, and renders can happen more than you expect. Using the functional update form
        makes your code more reliable today and safer for future changes (including changes made by teammates).
      </p>
    </main>
  </div>
</body>
</html>