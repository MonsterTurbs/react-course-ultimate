

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Redux Toolkit ‚Äî Creating the Account Slice (Study Guide)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#555555;
      --border:#e6e6e6;
      --soft:#fafafa;
      --chip:#f3f4f6;
      --accent:#0b57d0;
      --good:#0f766e;
      --warn:#b45309;
      --bad:#b91c1c;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
      overflow-wrap:anywhere;
      word-break:break-word;
    }

    /* Single-column page container */
    .page{
      max-width: 860px;
      margin: 0 auto;
      padding: 28px 22px 40px;
    }

    header{
      border:1px solid var(--border);
      background:var(--soft);
      padding:18px 18px 14px;
      border-radius:12px;
    }
    h1{
      margin:0 0 8px;
      font-size: 1.55rem;
      line-height:1.25;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:0.98rem;
    }

    .meta{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .chip{
      display:inline-block;
      padding:6px 10px;
      border:1px solid var(--border);
      background:var(--chip);
      border-radius:999px;
      font-size:0.9rem;
      color:#222;
    }

    main{ margin-top:18px; }

    h2{
      font-size: 1.2rem;
      margin: 18px 0 10px;
      padding-top: 6px;
      border-top: 1px solid var(--border);
    }

    h3{
      font-size: 1.05rem;
      margin: 14px 0 8px;
    }

    p{ margin: 8px 0; }

    ul{ margin: 8px 0 12px 20px; }
    li{ margin: 6px 0; }

    .callout{
      border: 1px solid var(--border);
      border-left: 6px solid var(--accent);
      background: #fff;
      padding: 12px 14px;
      border-radius: 10px;
      margin: 12px 0;
    }
    .callout.good{ border-left-color: var(--good); }
    .callout.warn{ border-left-color: var(--warn); }
    .callout.bad{ border-left-color: var(--bad); }

    .callout .title{
      margin: 0 0 6px;
      font-weight: 700;
    }

    code, pre{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.95em;
    }

    pre{
      margin: 10px 0 14px;
      padding: 12px 12px;
      border: 1px solid var(--border);
      background: #fcfcfc;
      border-radius: 10px;
      white-space: pre-wrap;
      word-break: break-word;
      overflow: visible;
    }

    .hr{ height:1px; background:var(--border); border:0; margin:18px 0; }

    .twoColNote{
      border: 1px dashed var(--border);
      border-radius: 10px;
      padding: 12px 14px;
      background: #fff;
    }

    .kpi{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin: 10px 0;
    }
    .kpi .box{
      border:1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      background: #fff;
    }
    .kpi .box b{ display:block; margin-bottom:4px; }

    a{ color: var(--accent); text-decoration: underline; }

    /* Print rules */
    @page{
      size: A4;
      margin: 14mm 14mm 16mm;
    }
    @media print{
      body{ background:#fff; }
      .page{ max-width: none; padding: 0; }
      header{ background:#fff; }
      .chip{ background:#fff; }
      a{ color: var(--text); text-decoration: none; }
      a[href]::after{ content: ""; }
      pre{ page-break-inside: avoid; }
      .callout{ page-break-inside: avoid; }
      h2, h3{ page-break-after: avoid; }
      ul, ol{ page-break-inside: avoid; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>‚öôÔ∏è Redux Toolkit: Creating the <em>Account</em> Slice</h1>
      <p class="sub">Study guide for converting a classic Redux ‚Äúaccount slice‚Äù into Redux Toolkit using <code>createSlice</code>, including a real-world pitfall and the <code>prepare</code> pattern.</p>
      <div class="meta">
        <span class="chip">üìå Topic: Redux Toolkit Slices</span>
        <span class="chip">üß† Focus: <code>createSlice</code>, reducers-as-methods, auto actions</span>
        <span class="chip">‚ö†Ô∏è Includes: multi-argument payload via <code>prepare</code></span>
      </div>
    </header>

    <main>
      <h2>üéØ What you‚Äôre building in this lecture</h2>
      <p>You already have a classic Redux slice structure (in one file):</p>
      <ul>
        <li>‚úÖ <b>initial state</b></li>
        <li>‚úÖ <b>reducer</b> (with <code>switch(action.type)</code>)</li>
        <li>‚úÖ <b>action creators</b> (functions that return action objects)</li>
      </ul>
      <p>Now you convert that same ‚Äúaccount slice‚Äù to Redux Toolkit, where the slice concept is built-in through <code>createSlice</code>.</p>

      <div class="callout good">
        <p class="title">‚úÖ Big benefits you get from <code>createSlice</code></p>
        <ul>
          <li>ü™Ñ <b>Auto action creators</b> are generated from your reducer methods.</li>
          <li>üßπ <b>No switch statement</b>; the ‚Äúdefault case‚Äù is handled automatically.</li>
          <li>üß© You can write <b>mutating-looking reducers</b> (powered by Immer) while state remains immutable internally.</li>
        </ul>
      </div>

      <h2>üß† Mental model: Classic Redux vs Redux Toolkit</h2>

      <div class="kpi">
        <div class="box">
          <b>Classic Redux</b>
          <div>Reducer returns a <em>new state object</em> using spreads and copies.</div>
        </div>
        <div class="box">
          <b>Redux Toolkit</b>
          <div>Reducers are written like you‚Äôre <em>mutating</em> state (<code>state.balance += ...</code>), but Immer produces the immutable next state.</div>
        </div>
      </div>

      <h2>üß± Step-by-step: Convert the Account Slice</h2>

      <h3>1) Keep the initial state (mostly unchanged)</h3>
      <pre><code>const initialState = {
  balance: 0,
  loan: 0,
  loanPurpose: "",
  // Later, you might have: isLoading: false
};</code></pre>

      <h3>2) Create the slice with <code>createSlice</code></h3>
      <p>Import <code>createSlice</code> from Redux Toolkit and define: <b>name</b>, <b>initialState</b>, and <b>reducers</b>.</p>
      <pre><code>import { createSlice } from "@reduxjs/toolkit";

const accountSlice = createSlice({
  name: "account",
  initialState,
  reducers: {
    deposit(state, action) {
      state.balance += action.payload;
    },
    withdraw(state, action) {
      state.balance -= action.payload;
    },
    requestLoan(state, action) {
      if (state.loan &gt; 0) return; // already has a loan
      state.loan = action.payload.amount;
      state.loanPurpose = action.payload.purpose;
      state.balance += action.payload.amount;
    },
    payLoan(state) {
      // We'll fix an important pitfall about the order below
      state.balance -= state.loan;
      state.loan = 0;
      state.loanPurpose = "";
    },
  },
});</code></pre>

      <div class="callout warn">
        <p class="title">‚ö†Ô∏è Key detail: RTK action names are auto-generated</p>
        <p>
          With <code>name: "account"</code> and a reducer method named <code>deposit</code>, Redux Toolkit generates an action type like:
          <code>"account/deposit"</code>.
          This matches the ‚Äúdomain/action‚Äù naming convention you used earlier.
        </p>
      </div>

      <h3>3) Export the reducer (default) and actions (named)</h3>
      <pre><code>export default accountSlice.reducer;
export const { deposit, withdraw, requestLoan, payLoan } = accountSlice.actions;</code></pre>

      <p>Then your store can import the reducer exactly like before (RTK store setup was already converted earlier).</p>

      <h2>üß© The ‚Äúmulti-argument‚Äù problem and the <code>prepare</code> solution</h2>
      <p>
        Auto-generated action creators (like <code>requestLoan</code>) accept <b>only one argument by default</b>.
        That single argument becomes <code>action.payload</code>.
      </p>

      <div class="callout bad">
        <p class="title">‚ùå What goes wrong (symptom)</p>
        <ul>
          <li>You call: <code>dispatch(requestLoan(amount, purpose))</code></li>
          <li>But RTK only takes the <b>first</b> arg ‚Üí payload becomes only <code>amount</code></li>
          <li>So <code>action.payload.purpose</code> becomes <code>undefined</code> (loan purpose missing)</li>
        </ul>
      </div>

      <h3>Fix: Use the reducer object form with <code>prepare</code></h3>
      <p>
        If you want multiple arguments, define the reducer as an object with:
        <b><code>reducer</code></b> + <b><code>prepare</code></b>.
      </p>
      <pre><code>requestLoan: {
  reducer(state, action) {
    if (state.loan &gt; 0) return;
    state.loan = action.payload.amount;
    state.loanPurpose = action.payload.purpose;
    state.balance += action.payload.amount;
  },
  prepare(amount, purpose) {
    return {
      payload: { amount, purpose },
    };
  },
},</code></pre>

      <div class="callout good">
        <p class="title">‚úÖ Why this works</p>
        <p>
          <code>prepare(amount, purpose)</code> packs multiple inputs into <b>one payload object</b>, which is exactly what your reducer expects.
        </p>
      </div>

      <h2>‚ö†Ô∏è Real pitfall: Mutation order matters</h2>
      <p>
        Because reducers now look like mutations, the <b>order of statements</b> can change the result.
        In the lecture, the bug happened in <code>payLoan</code>:
      </p>

      <h3>Buggy version</h3>
      <pre><code>payLoan(state) {
  state.loan = 0;
  state.loanPurpose = "";
  state.balance -= state.loan; // subtracts 0 (because loan already became 0)
}</code></pre>

      <h3>Correct version</h3>
      <pre><code>payLoan(state) {
  state.balance -= state.loan; // use the existing loan value first
  state.loan = 0;
  state.loanPurpose = "";
}</code></pre>

      <div class="callout warn">
        <p class="title">üß† Practical rule</p>
        <p>If you need an ‚Äúold‚Äù value to compute another field, use it <b>before</b> you overwrite it.</p>
      </div>

      <h2>üß™ Quick verification checklist</h2>
      <ul>
        <li>‚úÖ Depositing updates <code>balance</code></li>
        <li>‚úÖ Withdrawing decreases <code>balance</code></li>
        <li>‚úÖ Requesting a loan sets <code>loan</code> and <code>loanPurpose</code>, and also increases <code>balance</code></li>
        <li>‚úÖ Paying a loan reduces <code>balance</code>, resets <code>loan</code> and <code>loanPurpose</code></li>
        <li>‚úÖ Loan request is blocked when <code>state.loan &gt; 0</code></li>
        <li>‚úÖ <code>requestLoan(amount, purpose)</code> works (meaning <code>prepare</code> is correctly implemented)</li>
      </ul>

      <h2>üß∑ Mini-review: What you should remember</h2>
      <div class="twoColNote">
        <ul>
          <li>ü™Ñ <code>createSlice</code> bundles state + reducers + actions into one slice.</li>
          <li>üß© Action types become <code>"sliceName/reducerName"</code> automatically.</li>
          <li>üß† Auto action creators accept 1 argument by default ‚Üí use <code>prepare</code> for multiple args.</li>
          <li>‚ö†Ô∏è With mutation-style reducers, statement order can create subtle bugs.</li>
        </ul>
      </div>

      <h2>‚úÖ Practice tasks</h2>
      <ol>
        <li>Modify <code>requestLoan</code> so it also stores a <code>loanCreatedAt</code> timestamp using <code>prepare</code>.</li>
        <li>Add a new reducer <code>resetAccount</code> that sets balance/loan/purpose back to initial values.</li>
        <li>Try to intentionally break <code>payLoan</code> by changing the order again, then fix it and explain why.</li>
      </ol>

      <hr class="hr" />
      <p class="sub">Print tip: Use your browser‚Äôs Print dialog ‚Üí Paper size A4 ‚Üí Margins ‚ÄúDefault‚Äù (or ‚ÄúNone‚Äù if you prefer tighter spacing).</p>
    </main>
  </div>
</body>
</html>