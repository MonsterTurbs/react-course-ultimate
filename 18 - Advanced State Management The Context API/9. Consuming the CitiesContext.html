

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WorldWise ‚Äî Consuming the CitiesContext (useCities)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#5b5b5b;
      --border:#e6e6e6;
      --soft:#fafafa;
      --codebg: #f5f5f5;   /* light gray */
      --codefg: #111111; /* optional: make text dark */
      --accent:#1a73e8;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: Arial, Helvetica, sans-serif;
      line-height:1.6;
      overflow-wrap:anywhere;
      word-break:break-word;
    }

    .page{
      max-width: 900px;
      margin: 0 auto;
      padding: 22px 18px 40px;
    }

    header{
      padding: 16px 16px 14px;
      border: 1px solid var(--border);
      background: var(--soft);
      border-radius: 12px;
    }

    h1{
      margin: 0 0 6px;
      font-size: 22px;
      line-height: 1.25;
      letter-spacing: .2px;
    }

    .subtitle{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
    }

    .meta{
      margin-top: 10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }

    .chip{
      display:inline-block;
      padding: 4px 10px;
      border:1px solid var(--border);
      background:#fff;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }

    main{ padding: 14px 2px 0; }

    h2{
      margin: 18px 0 8px;
      font-size: 16px;
      line-height: 1.3;
    }

    h3{
      margin: 14px 0 8px;
      font-size: 14px;
      line-height: 1.3;
    }

    p{ margin: 8px 0; }

    ul,ol{ margin: 8px 0 8px 22px; padding: 0; }
    li{ margin: 6px 0; }

    .callout{
      border: 1px solid var(--border);
      border-left: 4px solid var(--accent);
      background: #fff;
      border-radius: 10px;
      padding: 12px 12px;
      margin: 10px 0;
    }

    .callout p{ margin: 6px 0; }

    .note{
      border-left-color: #7c3aed;
    }

    .warn{
      border-left-color: #d93025;
    }

    .ok{
      border-left-color: #1e8e3e;
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 2px 6px;
      border: 1px solid var(--border);
      border-bottom-width: 2px;
      border-radius: 6px;
      background: #fff;
      white-space: nowrap;
    }

    pre{
      margin: 10px 0;
      padding: 12px 12px;
      border-radius: 12px;
      background: var(--codebg);
      color: var(--codefg);
      overflow: auto;
      border: 1px solid rgba(255,255,255,.08);
    }

    code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px;
    }

    .inline-code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px;
      background: #f4f6fb;
      border: 1px solid var(--border);
      padding: 1px 6px;
      border-radius: 6px;
      white-space: nowrap;
    }

    .grid{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .divider{
      height: 1px;
      background: var(--border);
      margin: 14px 0;
    }

    .tiny{ font-size: 12px; color: var(--muted); }

    /* Print */
    @page{
      size: A4;
      margin: 14mm;
    }

    @media print{
      body{ background:#fff; }
      .page{ max-width: none; padding: 0; }
      header{ border-radius: 0; }
      a{ color: inherit; text-decoration: none; }
      a[href]::after{ content: ""; }
      pre{ white-space: pre-wrap; word-break: break-word; overflow: visible; }
      .chip{ border-color: #ddd; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>üß© WorldWise ‚Äî Consuming <span class="inline-code">CitiesContext</span> with a Custom Hook (<span class="inline-code">useCities</span>)</h1>
      <p class="subtitle">Study guide / reviewer: build a custom hook for a context, then refactor components to read data from context instead of props.</p>
      <div class="meta">
        <span class="chip">React Context API</span>
        <span class="chip">Custom Hook Pattern</span>
        <span class="chip">Refactor: remove prop drilling</span>
        <span class="chip">WorldWise</span>
      </div>
    </header>

    <main>
      <section>
        <h2>üéØ Goals of this lecture</h2>
        <ul>
          <li>Build <strong>one reusable hook</strong> (<span class="inline-code">useCities</span>) to read the Cities context anywhere in the tree.</li>
          <li>Add a <strong>safety guard</strong>: throw a helpful error if the hook is used outside the provider.</li>
          <li>Refactor <span class="inline-code">CityList</span> and <span class="inline-code">CountryList</span> to <strong>remove props</strong> and consume context instead.</li>
          <li>Understand the practical benefit: <strong>cleaner App routes + clearer ‚Äúwhere state lives‚Äù</strong>.</li>
        </ul>
      </section>

      <section class="callout note">
        <p><strong>üß† Key idea:</strong> Context exposes a <em>value</em> to its children. A custom hook is just a clean wrapper around <span class="inline-code">useContext(SomeContext)</span> so you don‚Äôt repeat it everywhere.</p>
      </section>

      <section>
        <h2>1) Build the custom hook: <span class="inline-code">useCities()</span></h2>
        <p>The hook is responsible for:</p>
        <ol>
          <li>Calling <span class="inline-code">useContext(CitiesContext)</span></li>
          <li>Returning the <strong>context value</strong> (example: <span class="inline-code">{ cities, isLoading }</span>)</li>
          <li>Throwing a clear error if the value is <span class="inline-code">undefined</span> (meaning: the hook was used outside the provider)</li>
        </ol>

        <div class="callout warn">
          <p><strong>‚ö†Ô∏è Why the undefined-check matters:</strong> Without it, a developer might accidentally call <span class="inline-code">useCities()</span> in a component that is <em>not wrapped</em> by <span class="inline-code">&lt;CitiesProvider&gt;</span>. That can lead to confusing runtime bugs.</p>
        </div>

        <h3>‚úÖ Example: CitiesContext.jsx</h3>
        <pre><code>// /src/context/CitiesContext.jsx
import { createContext, useContext, useEffect, useState } from "react";

const BASE_URL = "http://localhost:9000";

const CitiesContext = createContext();

function CitiesProvider({ children }) {
  const [cities, setCities] = useState([]);
  const [isLoading, setIsLoading] = useState(false);

  useEffect(function () {
    async function fetchCities() {
      try {
        setIsLoading(true);
        const res = await fetch(`${BASE_URL}/cities`);
        const data = await res.json();
        setCities(data);
      } catch (err) {
        alert("There was an error loading data...");
      } finally {
        setIsLoading(false);
      }
    }

    fetchCities();
  }, []);

  return (
    &lt;CitiesContext.Provider value={{ cities, isLoading }}&gt;
      {children}
    &lt;/CitiesContext.Provider&gt;
  );
}

function useCities() {
  const context = useContext(CitiesContext);

  // Guard: prevents silent bugs
  if (context === undefined)
    throw new Error("CitiesContext was used outside the CitiesProvider");

  return context;
}

export { CitiesProvider, useCities };</code></pre>

        <div class="callout ok">
          <p><strong>‚úÖ What you get:</strong> In components, you can now write <span class="inline-code">const { cities, isLoading } = useCities();</span> (clean and consistent).</p>
        </div>
      </section>

      <div class="divider"></div>

      <section>
        <h2>2) Consume the context in <span class="inline-code">CityList</span></h2>
        <p>Previously, <span class="inline-code">CityList</span> depended on props (example: <span class="inline-code">cities</span> and <span class="inline-code">isLoading</span>). Now it should read those values directly from the context using <span class="inline-code">useCities()</span>.</p>

        <h3>üîß Before (props)</h3>
        <pre><code>// CityList.jsx (old idea)
function CityList({ cities, isLoading }) {
  // ...
}</code></pre>

        <h3>‚úÖ After (context)</h3>
        <pre><code>// /src/components/CityList.jsx
import styles from "./CityList.module.css";
import Spinner from "./Spinner";
import CityItem from "./CityItem";
import Message from "./Message";
import { useCities } from "../context/CitiesContext";

export default function CityList() {
  const { cities, isLoading } = useCities();

  if (isLoading) return &lt;Spinner /&gt;;

  if (!cities.length)
    return (
      &lt;Message message="Add your first city by clicking on a city on the map." /&gt;
    );

  return (
    &lt;ul className={styles.cityList}&gt;
      {cities.map((city) =&gt; (
        &lt;CityItem city={city} key={city.id} /&gt;
      ))}
    &lt;/ul&gt;
  );
}</code></pre>

        <div class="callout note">
          <p><strong>üß† Reminder:</strong> After this refactor, you also don‚Äôt need to pass props into nested routes (less duplication in <span class="inline-code">App.jsx</span>).</p>
        </div>
      </section>

      <div class="divider"></div>

      <section>
        <h2>3) Consume the context in <span class="inline-code">CountryList</span></h2>
        <p>Same refactor: remove props, call <span class="inline-code">useCities()</span>, then derive the <strong>unique countries</strong> from the cities array.</p>

        <h3>‚úÖ Example: CountryList.jsx</h3>
        <pre><code>// /src/components/CountryList.jsx
import styles from "./CountryList.module.css";
import Spinner from "./Spinner";
import Message from "./Message";
import CountryItem from "./CountryItem";
import { useCities } from "../context/CitiesContext";

export default function CountryList() {
  const { cities, isLoading } = useCities();

  if (isLoading) return &lt;Spinner /&gt;;

  if (!cities.length)
    return (
      &lt;Message message="Add your first city by clicking on a city on the map." /&gt;
    );

  const countries = cities.reduce((arr, city) =&gt; {
    if (!arr.map((el) =&gt; el.country).includes(city.country))
      return [...arr, { country: city.country, emoji: city.emoji }];
    return arr;
  }, []);

  return (
    &lt;ul className={styles.countryList}&gt;
      {countries.map((country) =&gt; (
        &lt;CountryItem key={country.country} country={country} /&gt;
      ))}
    &lt;/ul&gt;
  );
}</code></pre>

        <div class="callout warn">
          <p><strong>‚ö†Ô∏è Key rule for <span class="inline-code">key</span>:</strong> It must be stable and unique. Here, <span class="inline-code">country.country</span> works because each country appears once after deduping.</p>
        </div>
      </section>

      <div class="divider"></div>

      <section>
        <h2>4) Why this pattern is valuable</h2>
        <div class="grid">
          <div class="callout ok">
            <p><strong>‚úÖ Cleaner routes:</strong> <span class="inline-code">App.jsx</span> becomes focused on routing only, not data plumbing.</p>
            <p class="tiny">Less noise in JSX: fewer props passed into nested route elements.</p>
          </div>

          <div class="callout ok">
            <p><strong>‚úÖ One obvious ‚Äúhome‚Äù for cities state:</strong> All fetching + loading state is now centralized in <span class="inline-code">CitiesProvider</span>.</p>
            <p class="tiny">If you want to understand ‚Äúwhere cities come from,‚Äù you know exactly where to look.</p>
          </div>

          <div class="callout note">
            <p><strong>üß† Better onboarding:</strong> If you open the project later (or a teammate does), the app is easier to read: routes in App, data in context, UI in components.</p>
          </div>
        </div>
      </section>

      <section>
        <h2>‚ö° Quick checklist (common mistakes)</h2>
        <ul>
          <li>‚úÖ Provider wraps the app: <span class="inline-code">&lt;CitiesProvider&gt;&lt;App /&gt;&lt;/CitiesProvider&gt;</span> (or inside App around routes)</li>
          <li>‚úÖ Custom hook exported and imported correctly: <span class="inline-code">export { CitiesProvider, useCities }</span></li>
          <li>‚úÖ Hook path correct in components (example): <span class="inline-code">../context/CitiesContext</span></li>
          <li>‚ö†Ô∏è If you see the guard error: your component is not a child of the provider.</li>
        </ul>
      </section>

      <section class="callout note">
        <p><strong>üß† Mini-recap:</strong> Create Provider + Value (cities + loading). Build <span class="inline-code">useCities()</span>. Replace props with context in <span class="inline-code">CityList</span> and <span class="inline-code">CountryList</span>.</p>
      </section>

      <p class="tiny">End of notes ‚Äî WorldWise (Context API: Consuming CitiesContext)</p>
    </main>
  </div>
</body>
</html>