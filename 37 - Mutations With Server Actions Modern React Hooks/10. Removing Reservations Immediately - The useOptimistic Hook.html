<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>React / Next.js Study Guide ‚Äî Optimistic UI with useOptimistic</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#555555;
      --border:#e6e6e6;
      --panel:#fafafa;
      --chip:#f3f4f6;
      --link:#0b57d0;
      --shadow: 0 8px 30px rgba(0,0,0,.06);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: Arial, Helvetica, sans-serif;
      line-height:1.6;
      overflow-wrap:anywhere; /* prevent cut-off */
      word-break:normal;
    }

    /* Single-column page */
    .page{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 18px 56px;
    }

    header{
      padding: 18px 18px;
      border:1px solid var(--border);
      border-radius: 14px;
      background: linear-gradient(180deg, #fff, var(--panel));
      box-shadow: var(--shadow);
    }

    h1{
      margin: 0 0 8px;
      font-size: 26px;
      letter-spacing: .2px;
      line-height: 1.25;
    }
    .subtitle{
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .toolbar{
      margin-top: 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:1px solid var(--border);
      background:#fff;
      border-radius: 10px;
      padding: 9px 12px;
      cursor:pointer;
      font-weight:600;
      font-size: 13px;
    }
    .btn:hover{ border-color:#cfcfcf; }
    .btn:active{ transform: translateY(1px); }

    .meta{
      margin-left:auto;
      color:var(--muted);
      font-size: 12px;
    }

    main{
      margin-top: 18px;
      padding: 18px;
      border:1px solid var(--border);
      border-radius: 14px;
      background:#fff;
      box-shadow: var(--shadow);
    }

    h2{
      margin: 18px 0 10px;
      font-size: 19px;
      line-height: 1.25;
    }
    h3{
      margin: 14px 0 8px;
      font-size: 15px;
      line-height: 1.3;
    }

    p{ margin: 8px 0; }
    ul{ margin: 8px 0 8px 20px; padding:0; }
    li{ margin: 6px 0; }

    .callout{
      border:1px solid var(--border);
      background: var(--panel);
      border-radius: 12px;
      padding: 12px 12px;
      margin: 12px 0;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin: 10px 0 0;
      padding: 0;
      list-style:none;
    }
    .chip{
      background: var(--chip);
      border:1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color:#222;
    }

    .divider{
      height:1px;
      background:var(--border);
      margin: 16px 0;
    }

    a{ color: var(--link); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    code, pre{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    pre{
      margin: 10px 0;
      padding: 12px;
      border:1px solid var(--border);
      border-radius: 12px;
      background:#fff;
      overflow:auto; /* ok on screen */
      max-width: 100%;
      box-shadow: 0 2px 14px rgba(0,0,0,.04);
    }
    code{
      background: var(--chip);
      padding: 1px 6px;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-size: 0.95em;
    }
    pre code{
      background: transparent;
      border: 0;
      padding: 0;
      border-radius: 0;
      font-size: 12.5px;
      line-height: 1.55;
      white-space: pre; /* screen */
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .qa{
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background:#fff;
    }
    .qa h3{ margin-top:0; }

    .small{ color:var(--muted); font-size: 13px; }

    /* Avoid any ‚Äúprint scrollbars‚Äù by removing fixed heights/overflows in print */
    @media print{
      @page{ size: A4; margin: 12mm; }

      body{ background:#fff; }
      .page{ padding: 0; margin: 0; max-width: none; }
      header, main{ box-shadow: none; }
      header{ break-inside: avoid; }

      .toolbar{ display:none !important; }

      a[href]::after{ content:""; } /* do not print URLs */
      pre{ overflow: visible; }
      pre code{
        white-space: pre-wrap;        /* wrap long code lines */
        overflow-wrap: anywhere;
        word-break: break-word;
      }

      .callout, .qa{ break-inside: avoid; }
      h2{ break-after: avoid; }
    }
  </style>
</head>

<body>
  <div class="page">
    <header>
      <h1>üß† Optimistic UI in Modern React (useOptimistic) ‚Äî Study Guide</h1>
      <p class="subtitle">
        Topic: Deleting reservations with <code>useOptimistic</code> to make the UI feel faster, plus a quick note on <code>loading.js</code> in Next.js route segments.
      </p>

      <div class="toolbar">
        <button class="btn" type="button" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
        <button class="btn" type="button" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚¨ÜÔ∏è Back to Top</button>
        <span class="meta">Single-column ‚Ä¢ A4 print-ready ‚Ä¢ Word-wrap enabled</span>
      </div>

      <ul class="chips" aria-label="key tags">
        <li class="chip">‚ö° Perceived performance</li>
        <li class="chip">‚úÖ Optimistic UI</li>
        <li class="chip">üîÅ Rollback on error</li>
        <li class="chip">üß© Client vs Server components</li>
        <li class="chip">üß† Reducer-like mental model</li>
      </ul>
    </header>

    <main>
      <h2>1) What is ‚ÄúOptimistic UI‚Äù?</h2>
      <p>
        ‚úÖ <strong>Optimistic UI</strong> is a technique where the interface updates <em>immediately</em> as if an async operation succeeded,
        even though the request is still running in the background.
      </p>

      <div class="callout">
        <p><strong>üöÄ Why it matters (Perceived Performance)</strong></p>
        <ul>
          <li>Users hate waiting and spinners everywhere.</li>
          <li>Even if the server takes 1‚Äì2 seconds, the app can feel ‚Äúinstant‚Äù if the UI updates right away.</li>
          <li>If the request fails, we ‚Äúundo‚Äù (rollback) the UI change and show the item again.</li>
        </ul>
      </div>

      <h3>üß† The ‚ÄúOptimistic‚Äù part</h3>
      <p>
        We are ‚Äúoptimistic‚Äù because we assume the async operation will succeed.
        If it fails, React can help restore the previous UI state.
      </p>

      <div class="divider"></div>

      <h2>2) The new hook: <code>useOptimistic</code></h2>
      <p>
        React introduced <code>useOptimistic</code> to support this common pattern: show an ‚Äúoptimistic state‚Äù while an async action is pending.
      </p>

      <div class="callout">
        <p><strong>üìå Key idea: you manage two states</strong></p>
        <ul>
          <li><strong>Actual state</strong> (truth from server/data source) ‚Äî e.g., <code>bookings</code>.</li>
          <li><strong>Optimistic state</strong> (what you want to show while async is pending) ‚Äî e.g., <code>optimisticBookings</code>.</li>
        </ul>
        <p class="small">
          Tip: This is why the hook can feel confusing at first‚Äîyou‚Äôre thinking in ‚Äúcurrent state‚Äù and ‚Äútemporary UI state.‚Äù
        </p>
      </div>

      <h3>Signature (mental model)</h3>
      <pre><code>// Conceptual
const [optimisticState, triggerOptimistic] = useOptimistic(
  actualState,
  (currentState, payload) =&gt; nextOptimisticState
);</code></pre>

      <ul>
        <li><code>actualState</code>: the baseline state when nothing is pending.</li>
        <li><code>(currentState, payload) =&gt; nextState</code>: computes the next optimistic state.</li>
        <li><code>optimisticState</code>: what you render in the UI.</li>
        <li><code>triggerOptimistic(payload)</code>: ‚Äúdispatch-like‚Äù function that starts the optimistic update.</li>
      </ul>

      <div class="divider"></div>

      <h2>3) Why you must move the list into a Client Component</h2>
      <p>
        Because <strong>hooks run in Client Components</strong>.
        If your reservations list was originally rendered in a Server Component (page/layout),
        you need to extract it into something like <code>ReservationList.js</code> and add the
        <code>'use client'</code> directive.
      </p>

      <div class="callout">
        <p><strong>üß© Pattern: Server fetches ‚Üí Client renders</strong></p>
        <ul>
          <li>Server Component: fetch bookings from DB / Supabase.</li>
          <li>Pass bookings as props into the Client Component.</li>
          <li>Client Component: uses hooks, renders list, handles optimistic updates.</li>
        </ul>
      </div>

      <pre><code>// Server Component (example)
import ReservationList from "./ReservationList";

export default async function AccountPage() {
  const bookings = await getBookings(); // server-side fetch
  return &lt;ReservationList bookings={bookings} /&gt;;
}</code></pre>

      <pre><code>// ReservationList.js (Client Component)
"use client";

import { useOptimistic } from "react";

export default function ReservationList({ bookings }) {
  // ...hooks + rendering
}</code></pre>

      <div class="divider"></div>

      <h2>4) Implementing optimistic delete (step-by-step)</h2>

      <h3>Step A ‚Äî set up <code>useOptimistic</code></h3>
      <pre><code>const [optimisticBookings, optimisticDelete] = useOptimistic(
  bookings,
  (currentBookings, bookingId) =&gt; {
    // compute "next optimistic state"
    return currentBookings.filter(b =&gt; b.id !== bookingId);
  }
);</code></pre>

      <div class="callout">
        <p><strong>‚úÖ What this does</strong></p>
        <ul>
          <li>Before any async work: <code>optimisticBookings === bookings</code></li>
          <li>After you call <code>optimisticDelete(id)</code>: UI uses the filtered list immediately.</li>
          <li>If the async operation fails: UI can rollback to the original state.</li>
        </ul>
      </div>

      <h3>Step B ‚Äî move the delete handler into the list container</h3>
      <p>
        Instead of letting each card call the server action directly, centralize the logic in <code>ReservationList</code>.
        Then pass down an <code>onDelete</code> prop (this is basic ‚Äúprop drilling‚Äù).
      </p>

      <pre><code>// ReservationList.js
import { deleteReservation } from "./actions"; // server action

async function handleDelete(bookingId) {
  // 1) Optimistically update UI first
  optimisticDelete(bookingId);

  // 2) Then do the real async delete on the server
  await deleteReservation(bookingId);
}</code></pre>

      <pre><code>// Render: IMPORTANT: use optimisticBookings, not bookings
return (
  &lt;ul&gt;
    {optimisticBookings.map(b =&gt; (
      &lt;ReservationCard key={b.id} booking={b} onDelete={handleDelete} /&gt;
    ))}
  &lt;/ul&gt;
);</code></pre>

      <h3>Step C ‚Äî wire props through components</h3>
      <pre><code>// ReservationCard.jsx
export default function ReservationCard({ booking, onDelete }) {
  return (
    &lt;div&gt;
      &lt;div&gt;{booking.cabinName}&lt;/div&gt;
      &lt;DeleteReservationButton bookingId={booking.id} onDelete={onDelete} /&gt;
    &lt;/div&gt;
  );
}</code></pre>

      <pre><code>// DeleteReservationButton.jsx
export default function DeleteReservationButton({ bookingId, onDelete }) {
  return (
    &lt;button onClick={() =&gt; onDelete(bookingId)}&gt;
      Delete
    &lt;/button&gt;
  );
}</code></pre>

      <div class="divider"></div>

      <h2>5) Testing the rollback behavior (very important)</h2>
      <p>
        üß™ A good way to confirm optimistic UI is working is to add an artificial delay and then force an error.
      </p>

      <pre><code>// Example helper
function delay(ms) {
  return new Promise(resolve =&gt; setTimeout(resolve, ms));
}

// Server action (example)
export async function deleteReservation(id) {
  await delay(2000);          // artificial delay for testing
  // throw new Error("Boom"); // force failure to test rollback
  await supabaseDelete(id);
}</code></pre>

      <div class="callout">
        <p><strong>‚úÖ Expected behavior</strong></p>
        <ul>
          <li>Click delete ‚Üí item disappears immediately.</li>
          <li>If server succeeds ‚Üí item stays gone.</li>
          <li>If server fails ‚Üí item re-appears (rollback) and you may see an error (e.g., 500).</li>
        </ul>
      </div>

      <div class="divider"></div>

      <h2>6) Reducer analogy (helps reduce confusion)</h2>
      <p>
        <code>useOptimistic</code> can feel similar to <code>useReducer</code>:
      </p>
      <ul>
        <li>üß† The ‚Äúupdate function‚Äù is like a reducer: <code>(currentState, payload) =&gt; nextState</code></li>
        <li>üîÅ The ‚ÄúoptimisticDelete‚Äù function is like dispatch: you call it with a payload.</li>
      </ul>

      <div class="callout">
        <p><strong>üìå Practical rule</strong></p>
        <p>
          Whatever data your real async action needs (e.g., <code>bookingId</code>),
          your optimistic updater usually needs the <em>same payload</em> to compute the optimistic UI state.
        </p>
      </div>

      <h3>Optimistic add example (quick contrast)</h3>
      <pre><code>// If optimistically ADDING an item instead of deleting:
(currentBookings, newBooking) =&gt; {
  return [...currentBookings, newBooking];
}</code></pre>

      <div class="divider"></div>

      <h2>7) Next.js note: <code>loading.js</code> for child route segments</h2>
      <p>
        The lecture also mentions a UX improvement: some pages take time to load but show no loading indicator.
        In the Next.js App Router, <code>loading.js</code> is applied at a route segment level.
        So if a child segment does not show the spinner, you can add/copy a <code>loading.js</code> into that segment.
      </p>

      <div class="callout">
        <p><strong>‚úÖ Outcome</strong></p>
        <ul>
          <li>Navigate/reload ‚Üí you immediately see a spinner while content streams in.</li>
          <li>This improves perceived performance and responsiveness.</li>
        </ul>
      </div>

      <pre><code>// Example structure (conceptual)
app/
  loading.js               // applies to this segment
  account/
    loading.js             // add/copy here if account pages need it
    page.js</code></pre>

      <div class="divider"></div>

      <h2>8) Common pitfalls and checklist</h2>

      <div class="grid">
        <section class="qa">
          <h3>‚ö†Ô∏è Pitfalls</h3>
          <ul>
            <li>Forgetting <code>"use client"</code> in the component that uses <code>useOptimistic</code>.</li>
            <li>Rendering <code>bookings</code> instead of <code>optimisticBookings</code> (no visible optimistic UI).</li>
            <li>Not passing the payload (<code>bookingId</code>) into <code>optimisticDelete</code>.</li>
            <li>Putting delete logic inside each card (harder to manage list-level state updates).</li>
          </ul>
        </section>

        <section class="qa">
          <h3>‚úÖ Implementation checklist</h3>
          <ul>
            <li>Client Component created for list rendering.</li>
            <li><code>useOptimistic(bookings, updater)</code> declared.</li>
            <li>UI renders <code>optimisticBookings</code>.</li>
            <li><code>handleDelete(id)</code> calls:
              <ul>
                <li>1) <code>optimisticDelete(id)</code></li>
                <li>2) <code>await deleteReservation(id)</code></li>
              </ul>
            </li>
            <li>Test with delay + forced error to confirm rollback works.</li>
          </ul>
        </section>
      </div>

      <div class="divider"></div>

      <h2>9) Quick self-test (no answers shown)</h2>
      <ul>
        <li>üß† Why does optimistic UI improve ‚Äúperceived performance‚Äù even if the server is still slow?</li>
        <li>üß© What are the two states you think about when using <code>useOptimistic</code>?</li>
        <li>üîÅ What should happen if the server action fails after you optimistically removed an item?</li>
        <li>‚öôÔ∏è Why must the reservations list be moved into a Client Component?</li>
        <li>üåÄ Why might adding <code>loading.js</code> to a child route segment fix missing spinners?</li>
      </ul>

      <p class="small">
        End of reviewer. You can print this to PDF using the button at the top (it will not appear in the printed output).
      </p>
    </main>
  </div>
</body>
</html>
